<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script>(function(){if(!window.tailwind){window.tailwind={config:{}};} if(!window.tailwind.config){window.tailwind.config={};}})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智慧药房收银系统 - 控制台</title>
    <link rel="stylesheet" href="css/tailwind.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/theme-enhanced.css" />
    <link rel="stylesheet" href="css/theme-premium.css" />
    <link rel="stylesheet" href="css/theme-lightwide.css" />
    <link rel="stylesheet" href="css/ui-enhanced.css" />
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script>if(typeof tailwind==='undefined'){window.tailwind={config:{}};}</script>
    <!-- 保留原 tailwind.config 自定义可在此扩展 -->
    <script>tailwind.config={theme:{extend:{colors:{primary:'#165DFF',secondary:'#36B37E',accent:'#FF5630'},fontFamily:{inter:['Inter','system-ui','sans-serif']}}}};</script>
    <style>
      /* 保留仅页面特有或覆盖性样式 */
      .dashboard-kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.5rem}
    </style>
    <!-- 引入 Chart.js CDN，确保在自定义 JS 之前加载 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="font-inter text-gray-800 min-h-screen flex enhanced-ui theme-modern theme-lightwide page-enter">
<a href="#main-content" class="skip-link">跳到主内容</a>
<div class="scroll-progress" id="scroll-progress"></div>
<!-- 注入统一导航（侧边栏 + 顶部） -->
<div id="common-nav" data-active="dashboard"></div>
<!-- 添加通知面板占位，避免元素不存在日志警告，可根据真实UI替换 -->
<div id="notification-panel" class="hidden absolute top-20 right-6 bg-white shadow-lg rounded-lg p-4 w-64 text-sm">
  <div class="font-medium mb-2">通知面板</div>
  <p class="text-gray-500">暂无通知</p>
</div>

<main class="flex-1 flex flex-col pt-16">
    <div class="main-content" id="main-content"><div class="container-fluid section-gap"><div class="app-shell">
        <!-- 页面标题与操作按钮 -->
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4 action-bar">
            <div>
                <h2 class="text-[clamp(1.25rem,2vw,1.75rem)] font-bold page-title-decor heading-accent">控制台概览</h2>
                <p class="text-gray-500">实时监控药房运营数据</p>
            </div>
            <div class="flex gap-3">
                <button class="btn btn-tonal btn-pill" id="export-report">
                    <i class="fa fa-download"></i> 导出报表
                </button>
                <button class="btn btn-gradient btn-pill" id="refresh-data">
                    <i class="fa fa-refresh"></i> 刷新数据
                </button>
            </div>
        </div>

        <!-- 数据统计卡片 -->
        <div class="dashboard-kpis kpi-horizontal mb-6" id="dashboard-kpi-row">
            <!-- 今日销售额 -->
            <div class="card card-interactive elevation-2 p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-500 text-sm">今日销售额</p>
                        <h3 class="text-2xl font-bold mt-1" id="todaySales">--</h3>
                    </div>
                    <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center text-primary">
                        <i class="fa fa-money"></i>
                    </div>
                </div>
                <div class="flex items-center text-sm">
                        <span class="text-secondary flex items-center" id="salesChange">
                            <i class="fa fa-arrow-up mr-1"></i> --
                        </span>
                    <span class="text-gray-500 ml-2">较昨日</span>
                </div>
            </div>

            <!-- 今日订单 -->
            <div class="card card-interactive elevation-2 p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-500 text-sm">今日订单</p>
                        <h3 class="text-2xl font-bold mt-1" id="todayOrders">--</h3>
                    </div>
                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600">
                        <i class="fa fa-shopping-cart"></i>
                    </div>
                </div>
                <div class="flex items-center text-sm">
                        <span class="text-secondary flex items-center" id="ordersChange">
                            <i class="fa fa-arrow-up mr-1"></i> --
                        </span>
                    <span class="text-gray-500 ml-2">较昨日</span>
                </div>
            </div>

            <!-- 会员消费 -->
            <div class="card card-interactive elevation-2 p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-500 text-sm">会员消费</p>
                        <h3 class="text-2xl font-bold mt-1" id="memberConsumption">--</h3>
                    </div>
                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600">
                        <i class="fa fa-users"></i>
                    </div>
                </div>
                <div class="flex items-center text-sm">
                        <span class="text-secondary flex items-center" id="memberChange">
                            <i class="fa fa-arrow-up mr-1"></i> --
                        </span>
                    <span class="text-gray-500 ml-2">较昨日</span>
                </div>
            </div>

            <!-- 库存预警 (原第4卡) -->
            <div class="card card-interactive elevation-2 p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-500 text-sm">库存预警</p>
                        <h3 class="text-2xl font-bold mt-1" id="lowStockCount">--</h3>
                    </div>
                    <div class="w-10 h-10 bg-accent/10 rounded-lg flex items-center justify-center text-accent">
                        <i class="fa fa-exclamation-triangle"></i>
                    </div>
                </div>
                <div class="flex items-center text-sm">
                        <span class="text-accent flex items-center" id="stockChange">
                            <i class="fa fa-arrow-up mr-1"></i> --
                        </span>
                    <span class="text-gray-500 ml-2">较昨日</span>
                </div>
            </div>

            <!-- 新增: 近效期药品 -->
            <div class="card card-interactive elevation-2 p-6" id="nearExpiryCard">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-500 text-sm">近效期药品</p>
                        <h3 class="text-2xl font-bold mt-1" id="nearExpiryCount">--</h3>
                    </div>
                    <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600">
                        <i class="fa fa-clock-o"></i>
                    </div>
                </div>
                <div class="flex items-center text-sm">
                    <span class="text-orange-600 flex items-center" id="nearExpiryChange">
                        <i class="fa fa-arrow-up mr-1"></i> --
                    </span>
                    <span class="text-gray-500 ml-2">动态统计</span>
                </div>
            </div>
        </div>

        <!-- 图表区域 -->
        <div class="dashboard-charts grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- 销售趋势图表 -->
            <div class="card p-6 lg:col-span-2">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold">销售趋势</h3>
                    <div class="flex gap-2">
                        <button class="btn btn-outline text-sm px-3 py-1" data-period="day">日</button>
                        <button class="btn btn-primary text-sm px-3 py-1" data-period="week">周</button>
                        <button class="btn btn-outline text-sm px-3 py-1" data-period="month">月</button>
                    </div>
                </div>
                <div class="h-80">
                    <canvas id="sales-chart"></canvas>
                </div>
            </div>

            <!-- 药品分类占比图表 -->
            <div class="card p-6">
                <h3 class="font-bold mb-6">药品分类占比</h3>
                <div class="h-80">
                    <canvas id="category-chart"></canvas>
                </div>
            </div>
        </div>
        <!-- 新增：查看盘点详情按钮移动到图表区域下方 -->
        <div class="flex justify-end mb-6" id="audit-actions">
          <button id="open-audit-btn" type="button" class="btn btn-outline"><i class="fa fa-list"></i> 查看盘点详情</button>
        </div>
        <!-- 今日热销药品 -->
        <div class="card mb-6" id="hot-products-card">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold">今日热销药品</h3>
                <a href="products.html" class="text-primary hover:underline text-sm">查看全部</a>
            </div>
            <div class="overflow-x-auto">
                <table class="table-modern w-full" id="hot-products-table">
                    <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">药品名称</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">规格</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">单价</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">今日销量</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">销售额</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">库存状态</th>
                    </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="hot-products">
                    <!-- 数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div></div></div>
</main>

<!-- 盘点详情模态 -->
<div id="audit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-lg w-full max-w-xl max-h-[90vh] overflow-y-auto">
    <div class="p-4 border-b flex justify-between items-center">
      <h3 class="font-bold text-lg">库存盘点详情</h3>
      <button id="audit-modal-close" class="text-gray-500 hover:text-gray-700">✕</button>
    </div>
    <div class="p-4 text-sm" id="audit-modal-body">
      <p class="text-gray-500 mb-2">从库存页面同步的低库存 / 缺货 / 近效期 / 已过期药品（按���品去重）。</p>
      <div id="audit-lowstock-section" class="mb-4">
        <h4 class="font-medium mb-1">低库存 / 缺货 (<span id="audit-lowstock-count">0</span> 种)</h4>
        <div id="audit-lowstock-list" class="space-y-1"></div>
      </div>
      <div id="audit-expiry-section" class="mb-2">
        <h4 class="font-medium mb-1">近效期 / 已过期 (<span id="audit-expiry-count">0</span> 种)</h4>
        <div id="audit-expiry-list" class="space-y-1"></div>
      </div>
    </div>
  </div>
</div>

<!-- 注入���一导航脚本 -->
<script src="js/common.js"></script>
<script src="js/common-nav.js"></script>
<script src="js/stock-status.js"></script>
<script src="js/ui-global.js" defer></script>
<!-- 去除内联滚动/主题脚本：已由 ui-global.js 统一处理 -->
</body>
</html>
